BARANGAY MODULE IMPLEMENTATION GUIDE
====================================

OVERVIEW
--------
The Barangay Justice Module transforms the eJustice Portal into a comprehensive system 
that captures the complete Philippine justice workflow from initial complaint through 
Barangay mediation to formal court proceedings.

DATABASE SCHEMA
---------------
The module adds 8 new tables:

1. barangay_info
   - Stores information about each Barangay
   - Includes Punong Barangay details and contact information

2. barangay_users
   - Links users to specific Barangay assignments
   - Tracks positions (Clerk, Punong Barangay, Lupon Secretary)

3. barangay_records
   - Core table for complaint records
   - Stores complainant/respondent info, dispute category, nature
   - Tracks record status from ACTIVE through ESCALATED

4. barangay_mediation_efforts
   - Records each mediation session
   - Tracks attendees, outcomes, descriptions of attempts

5. barangay_mediation_summary
   - Stores Punong Barangay's official mediation summary
   - Includes recommendations and observations
   - Supports digital signatures

6. barangay_settlements
   - Stores official settlement documents
   - Supports Kasunduan, CFA, and CNA forms
   - Digital signature and verification support

7. barangay_cfa
   - Tracks Certificate to File Action documents
   - Links to police blotter case numbers
   - Tracks police acknowledgment

8. barangay_documents
   - File storage for case attachments
   - Supports encrypted document storage

9. barangay_audit_log
   - Complete audit trail of all Barangay actions
   - Tracks who did what, when, and from where

NEW USER ROLES
--------------
- barangay_staff: General Barangay office staff, can view and manage records
- punong_barangay: Village chief with authority to approve mediation summaries
- lupon_secretary: Barangay Lupon secretary, handles mediation coordination

WORKFLOW
--------

Step 1: Create Complaint Record
Location: barangay_record_entry.php
Users: barangay_staff, punong_barangay, lupon_secretary
Actions:
  - Fill in complainant and respondent information
  - Select dispute category (Criminal, Civil, Administrative)
  - Provide nature and details of dispute
  - Schedule initial mediation date
  - System auto-generates unique complaint number (BR-YYYYMM-NNNNN)

Step 2: Record Mediation Efforts
Location: barangay_mediation.php
Users: Any authorized Barangay personnel
Actions:
  - Log each mediation session/attempt
  - Record who attended (complainant, respondent, others)
  - Document settlement attempts made
  - Update status after each session

Step 3: Mediation Summary by Punong Barangay
Location: barangay_mediation.php (Mediation Summary section)
Users: punong_barangay, lupon_secretary
Actions:
  - Write official mediation summary
  - Note if parties attended
  - Document all settlement attempts
  - Provide observations and recommendations
  - Decide case status: SETTLED, ESCALATED, or DISMISSED

Step 4a: If Case is SETTLED
Location: barangay_settlement_form.php
Users: Any authorized personnel
Actions:
  - Generate Kasunduan sa Pag-aayos (Settlement Agreement)
  - Include agreed terms and conditions
  - Print or export for parties to sign
  - Document signatures in system
  - Case moves to CLOSED status

Step 4b: If Case is ESCALATED (Unresolved)
Location: barangay_settlement_form.php
Users: Any authorized personnel
Actions:
  - Generate Certificate to File Action (CFA)
  - Document reason for escalation
  - Select escalation destination (Police or Court)
  - System automatically creates Police Blotter case
  - Case status updates to ESCALATED
  - CFA links to new police case number

FORMS & DOCUMENTS
-----------------

1. BARANGAY RECORD
   - Initial complaint filing form
   - Captures all dispute information
   - Auto-numbered with unique complaint number
   - Stored in system for audit trail

2. MEDIATION EFFORT LOG
   - Documents each mediation attempt
   - Shows progression toward settlement
   - Tracks dates and outcomes
   - Helps demonstrate compliance with procedures

3. KASUNDUAN SA PAG-AAYOS (Settlement Agreement)
   - Official settlement document
   - Equivalent to formal court settlement
   - Includes party signatures and dates
   - Digital signature support for verification
   - Printable for records

4. CERTIFICATE TO FILE ACTION (CFA)
   - Issued when mediation unsuccessful
   - Required for case to proceed to police/court
   - Proves compliance with Barangay procedures
   - Digitally tracked and linked to police case
   - Prevents duplicative cases

5. CERTIFICATE OF NON-APPEARANCE (CNA)
   - Used when party fails to mediate
   - Explains reason for non-resolution
   - Supports escalation of case

AUTOMATIC ESCALATION
---------------------

When a case is marked as ESCALATED in Barangay:

1. System checks for existing CFA document
2. System generates unique case number in Police Blotter format (PB-YYYYMM-NNNNN)
3. New case is created in main "cases" table with stage='police_blotter'
4. All Barangay information is transferred to police case
5. CFA record is updated with linked police blotter number
6. Status is updated to acknowledge police receipt
7. Case is now visible in Police staff dashboard

Benefits:
  ✓ No manual entry required (reduces errors)
  ✓ Complete history preserved (Barangay record stays for audit)
  ✓ Reduces case processing time
  ✓ Prevents loss of crucial information
  ✓ Creates permanent audit trail

DASHBOARD
---------

Barangay Dashboard (barangay_dashboard.php) provides:

Statistics:
  - Cases filed this month
  - Active cases pending mediation
  - Cases settled this month
  - Overall settlement rate percentage

Quick Actions:
  - Create new complaint record
  - View all records
  - View pending escalations

Displays:
  - List of pending mediation cases (newest first)
  - Case status distribution (pie chart data)
  - Dispute categories this month
  - Pending escalations requiring CFA
  - Recent activity log (last 15 activities)

AUDIT LOGGING
-------------

Every Barangay action is logged:
  - RECORD_CREATED: When new complaint filed
  - ESCALATED_TO_POLICE: When case sent to police
  - SETTLEMENT_FORM_CREATED: When document generated
  - Plus full audit trail in main system

Tracked Information:
  - Who performed the action (user_id)
  - When it happened (timestamp)
  - What was affected (record_id, document_id)
  - Where it came from (IP address)
  - What changed (action_details)

ACCESS CONTROL
--------------

barangay_staff:
  ✓ Can view their assigned Barangay only
  ✓ Can create complaint records
  ✓ Can record mediation efforts
  ✓ Can view case details

punong_barangay:
  ✓ All staff permissions
  ✓ Can submit official mediation summaries
  ✓ Can sign settlement documents
  ✓ Can initiate case escalation
  ✓ Can view settlement rate and statistics

lupon_secretary:
  ✓ Same as Punong Barangay
  ✓ Typically prepares documents for PB approval

system_admin:
  ✓ Can access all Barangay modules
  ✓ Can view system-wide statistics
  ✓ Can audit all activities
  ✓ Can manage user assignments

ENHANCEMENT IDEAS
-----------------

1. NOTIFICATIONS
   - Email to complainant/respondent when mediation scheduled
   - SMS reminders before mediation date
   - Email confirmation when case settled or escalated

2. SIGNATURES
   - Digital signature capture (currently placeholder)
   - QR code generation for document verification
   - PDF signing support

3. CALENDAR
   - Barangay Lupon mediation calendar
   - Automated scheduling system
   - Conflict detection and booking management

4. REPORTS
   - Monthly settlement rate report
   - Case category analysis
   - Performance metrics by mediator
   - Escalation trend analysis

5. INTEGRATION
   - Two-way sync with police blotter
   - SMS two-way communication
   - Mobile app for field mediation
   - Complainant online status tracking

6. ANALYTICS
   - Average time to settle
   - Settlement rate by category
   - Staff performance metrics
   - Seasonal trend analysis

TROUBLESHOOTING
---------------

Issue: "Barangay assignment not found"
Solution: 
  1. Check that barangay_info has records
  2. Verify user exists in barangay_users table
  3. Run seed_demo_users.php again

Issue: CFA not creating police case
Solution:
  1. Ensure 'police_staff' user exists in system
  2. Check that police_staff role is set correctly
  3. Review error logs in barangay_escalation.php

Issue: Audit log not showing entries
Solution:
  1. Verify barangay_audit_log table exists
  2. Check user permissions to view logs
  3. Confirm actions are being performed by authenticated users

SECURITY NOTES
--------------
- All user input is validated and sanitized
- SQL injection prevented with prepared statements
- Session checking on all protected pages
- Role-based access control enforced
- All actions logged for audit trail
- Consider implementing:
  * Two-factor authentication
  * IP address whitelisting for Barangay offices
  * Data encryption for sensitive records
  * Regular backups of Barangay data

FILES CREATED/MODIFIED
-----------------------

New Files:
  - public/barangay_record_entry.php
  - public/barangay_mediation.php
  - public/barangay_settlement_form.php
  - public/barangay_dashboard.php
  - includes/barangay_escalation.php
  - sql/003_add_barangay_module.sql

Modified Files:
  - public/seed_demo_users.php (added Barangay users and demo data)
  - includes/header.php (added Barangay navigation menu)
  - public/css/court_system.css (added Barangay styling)
  - README.txt (updated documentation)

TESTING CHECKLIST
-----------------

□ Create Barangay complaint record
□ Add multiple mediation efforts
□ Submit mediation summary
□ Generate Kasunduan for settled case
□ Generate CFA for escalated case
□ Verify police case was created
□ Check audit logs for all actions
□ View Barangay dashboard statistics
□ Test with different user roles
□ Verify access restrictions
□ Check responsive design on mobile

VERSION HISTORY
---------------

v1.0 - Initial Barangay Module Release
  Features:
    - Complete Barangay complaint workflow
    - Mediation tracking
    - Settlement form generation
    - Automatic escalation to police
    - Audit logging
    - Dashboard with statistics

Next versions planned:
  - Digital signature implementation
  - Mobile app integration
  - SMS notification system
  - Advanced analytics
  - Multi-Barangay administration

For support or questions, refer to main system documentation.
