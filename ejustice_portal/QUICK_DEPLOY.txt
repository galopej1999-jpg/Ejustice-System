QUICK START: Netlify + Railway Deployment
==========================================

Pre-Deploy Checklist (5 minutes)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Generate encryption key:
   
   openssl rand -hex 32
   
   (Copy the output; you'll need it for Railway)

2. Ensure repo is ready:
   - config/config.php âœ… (now reads env vars)
   - config/db.php âœ… (now reads DATABASE_URL)
   - .env.example âœ… (created)
   - netlify.toml âœ… (created)
   - public/_redirects âœ… (created)

3. Verify all SQL migrations are in sql/ folder:
   - sql/ejustice_portal.sql
   - sql/002_add_audit_logs.sql
   - sql/003_add_barangay_module.sql
   - sql/004_add_barangay_case_routing.sql

Deploy Backend (Railway): 10 minutes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Go to railway.app â†’ Sign up/Login
2. New Project â†’ Import from GitHub
3. Select ejustice_portal repo
4. Add Service â†’ MySQL
5. Set Variables:
   - DOC_ENC_KEY: [paste from step above]
   - APP_ENV: production
   - APP_DEBUG: false
6. Deploy (auto happens; wait 2-5 min)
7. Once deployed, copy the Railway app URL (e.g., https://ejustice-portal-xyz.railway.app)

Run Database Migrations: 5 minutes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Option A (easiest): Use phpMyAdmin
- Railway dashboard â†’ MySQL service â†’ Open phpMyAdmin
- Import sql/ejustice_portal.sql
- Import sql/002_add_audit_logs.sql
- Import sql/003_add_barangay_module.sql
- Import sql/004_add_barangay_case_routing.sql

Option B: Use MySQL CLI (if you have it locally)
- Get Railway DB credentials from Variables
- Run: mysql -h [host] -u [user] -p[password] ejustice_portal < sql/ejustice_portal.sql
- Repeat for other SQL files

Deploy Frontend (Netlify): 10 minutes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Go to netlify.com â†’ Sign up/Login
2. New site â†’ Import from GitHub
3. Select ejustice_portal repo
4. Build settings:
   - Build command: (leave empty)
   - Publish directory: public
5. Deploy
6. **IMPORTANT**: In your repo, update these files:
   
   netlify.toml:
     Line 16: Replace RAILWAY_BACKEND_URL with your Railway URL
   
   public/_redirects:
     Line 7: Replace RAILWAY_BACKEND_URL with your Railway URL
   
   Example if Railway URL is https://ejustice-portal-prod.railway.app:
   
   /*  https://ejustice-portal-prod.railway.app/:splat  200

7. Commit and push changes
8. Netlify auto-redeploys

Test: 5 minutes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Go to your Netlify URL (or custom domain)
2. Should see login page
3. Login with: admin@example.com / password
4. Try:
   - File a case
   - View in Barangay
   - Add mediation effort
   - Generate CFA
   - Check escalation to police
   - Upload and view document

If anything fails, check:
- Railway logs: Railway dashboard â†’ Logs tab
- Netlify logs: Netlify dashboard â†’ Deploys â†’ Deploy log
- Browser console: F12 â†’ Console tab (check for errors)

Common Issues & Fixes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âŒ "Database connection failed"
   â†’ Check DATABASE_URL is set in Railway Variables
   â†’ Ensure MySQL service is running

âŒ "Redirects not working; 404"
   â†’ Check netlify.toml: RAILWAY_BACKEND_URL replaced?
   â†’ Check public/_redirects: RAILWAY_BACKEND_URL replaced?
   â†’ Redeploy after edits

âŒ "Login page appears but login fails"
   â†’ Check Railway logs for PHP errors
   â†’ Verify migrations imported successfully

âŒ "File uploads fail"
   â†’ Check storage/documents/ exists
   â†’ Verify DOC_ENC_KEY set correctly in Railway

Full Deployment Guide
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
See DEPLOYMENT_NETLIFY_RAILWAY.md for detailed steps, troubleshooting, and architecture.

Done! Your app is now live! ðŸŽ‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Your app is accessible at:
- Netlify URL: https://[netlify-site-name].netlify.app
- Or your custom domain (if configured)

All requests proxy to Railway backend automatically.

Questions?
- Railway docs: docs.railway.app
- Netlify docs: docs.netlify.com
- This repo: See DEPLOYMENT_NETLIFY_RAILWAY.md

---
Deployed: November 28, 2025
